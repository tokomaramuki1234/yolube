# 既存GASコードのバックアップ手順（詳細版）

## 📋 目次
1. [事前準備](#事前準備)
2. [Google Sheetsへアクセス](#google-sheetsへアクセス)
3. [Apps Scriptエディタを開く](#apps-scriptエディタを開く)
4. [既存コードを確認](#既存コードを確認)
5. [コードをバックアップ](#コードをバックアップ)
6. [バックアップの保存](#バックアップの保存)

---

## 事前準備

### 必要なもの
- ✅ Googleアカウント（スプレッドシートへのアクセス権限があるアカウント）
- ✅ インターネット接続
- ✅ Chromeまたは他のモダンブラウザ

### ⚠️ 重要な注意事項
**必ずシークレットモードで作業してください**

README.mdに記載されている通り：
> 必ずシークレットモードで「単一のアカウントでのみGASへアクセスしている状態」で作業すること。

**理由**: 複数のGoogleアカウントでログインしていると、権限エラーやアクセス問題が発生する可能性があります。

---

## Google Sheetsへアクセス

### ステップ 1: シークレットモードでブラウザを開く

#### Chromeの場合
1. Chromeを開く
2. 右上の「︙」（3点メニュー）をクリック
3. 「新しいシークレット ウィンドウ」をクリック
   - または、キーボードショートカット: `Ctrl + Shift + N` (Windows) / `Cmd + Shift + N` (Mac)

#### Edgeの場合
1. Edgeを開く
2. 右上の「…」をクリック
3. 「新しいInPrivateウィンドウ」をクリック
   - または、`Ctrl + Shift + N`

#### Firefoxの場合
1. Firefoxを開く
2. 右上の「≡」をクリック
3. 「新しいプライベートウィンドウ」をクリック
   - または、`Ctrl + Shift + P`

### ステップ 2: Googleアカウントにログイン

シークレットモードのウィンドウで：

1. https://accounts.google.com にアクセス
2. スプレッドシートへのアクセス権限がある**単一のアカウント**でログイン
3. ログインしたら、他のアカウントは追加しない

### ステップ 3: スプレッドシートを開く

以下のURLにアクセス：
```
https://docs.google.com/spreadsheets/d/14roOdnMm4kdnL64OWkXdgMJ_qSampUuzr-tvEGeGhb4/edit
```

または：

1. https://sheets.google.com にアクセス
2. 最近使用したファイルから「YOLUBE Event Schedule」を探す
3. クリックして開く

---

## Apps Scriptエディタを開く

### ステップ 1: メニューバーから「拡張機能」を開く

スプレッドシートが開いたら：

```
画面上部のメニューバー:
[ファイル] [編集] [表示] [挿入] [表示形式] [データ] [ツール] [拡張機能] [ヘルプ]
                                                              ↑
                                                          ここをクリック
```

### ステップ 2: 「Apps Script」を選択

拡張機能メニューが開くので：

```
拡張機能 ▼
├─ アドオン
├─ アドオンを取得
├─ マクロ
└─ Apps Script  ← これをクリック
```

**注意**:
- 「Apps Script」が表示されない場合は、アカウントに権限がない可能性があります
- 管理者に確認してください

### ステップ 3: Apps Scriptエディタが開く

新しいタブで Apps Script エディタが開きます：

```
┌─────────────────────────────────────────────────────────────┐
│ Apps Script - [プロジェクト名]                              │
├─────────────────────────────────────────────────────────────┤
│ 左側パネル（ファイル一覧）│  右側パネル（コードエディタ）      │
│                           │                                  │
│ ファイル                  │  function doPost(e) {            │
│ ├─ コード.gs              │    // コードがここに表示される    │
│ ├─ その他のファイル.gs    │  }                               │
│ └─ ...                    │                                  │
│                           │                                  │
│ サービス                  │                                  │
│ ライブラリ               │                                  │
└───────────────────────────┴──────────────────────────────────┘
```

---

## 既存コードを確認

### ステップ 1: すべてのファイルを確認

左側のパネルで、すべての `.gs` ファイルを確認します：

```
ファイル
├─ コード.gs          ← メインファイル（doPost, doGetなどがある）
├─ Utils.gs           ← ヘルパー関数（もしあれば）
├─ EmailTemplates.gs  ← メールテンプレート（もしあれば）
└─ ...                ← その他のファイル
```

### ステップ 2: 各ファイルの内容を確認

各ファイルをクリックして、どのような関数が含まれているか確認：

**確認すべき主要な関数**:
- `doPost(e)` - POSTリクエストを処理
- `doGet(e)` - GETリクエストを処理
- `handleContactForm()` または類似の関数 - お問い合わせフォーム処理
- メール送信関数
- スプレッドシート操作関数

### ステップ 3: コードの行数を確認

右側エディタの左下に行数が表示されています：

```
[1/250行]  ← 現在のカーソル位置 / 総行数
```

---

## コードをバックアップ

### 方法1: すべてのコードを1つのファイルにコピー（推奨）

#### ステップ 1: 新しいテキストファイルを作成

デスクトップに新しいテキストファイルを作成：

1. デスクトップで右クリック
2. 「新規作成」→「テキスト ドキュメント」（Windows）
3. ファイル名を `GAS_BACKUP_20251006.txt` に変更
   - 形式: `GAS_BACKUP_YYYYMMDD.txt`（日付を入れる）

または、メモ帳を開いて新しいファイルを作成。

#### ステップ 2: 各ファイルのコードをコピー

**ファイル1: コード.gs**

1. 左側パネルで「コード.gs」をクリック
2. 右側エディタで、すべてのコードを選択
   - キーボードショートカット: `Ctrl + A` (Windows) / `Cmd + A` (Mac)
   - または、エディタ内で右クリック → 「すべて選択」

3. コピー
   - キーボードショートカット: `Ctrl + C` (Windows) / `Cmd + C` (Mac)
   - または、右クリック → 「コピー」

4. バックアップファイル（GAS_BACKUP_20251006.txt）を開く

5. 以下の形式でペースト：

```javascript
// ============================================
// ファイル名: コード.gs
// バックアップ日時: 2025-10-06
// ============================================

[ここにコードをペースト]

// ============================================
// ファイル終了: コード.gs
// ============================================
```

**ファイル2以降も同様に**

他のファイルも同じ手順で、バックアップファイルに追加：

```javascript
// ============================================
// ファイル名: Utils.gs
// バックアップ日時: 2025-10-06
// ============================================

[ここにコードをペースト]

// ============================================
// ファイル終了: Utils.gs
// ============================================
```

#### ステップ 3: バックアップファイルを保存

1. メモ帳の「ファイル」→「上書き保存」
2. または `Ctrl + S`

### 方法2: Apps Scriptのエクスポート機能を使う

Apps Scriptには標準のエクスポート機能はありませんが、以下の方法でプロジェクト全体をダウンロードできます：

#### Git リポジトリとしてクローン（上級者向け）

1. Apps Script エディタの左側メニュー「プロジェクトの設定」（⚙️アイコン）
2. 「Google Cloud Platform（GCP）プロジェクト」セクションを確認
3. clasp（コマンドラインツール）を使用してクローン

**注意**: この方法は上級者向けです。初心者は方法1を推奨します。

---

## バックアップの保存

### ステップ 1: ファイルの保存先を決める

以下のいずれかの場所に保存：

**オプションA: デスクトップ**
```
C:\Users\[ユーザー名]\Desktop\GAS_BACKUP_20251006.txt
```

**オプションB: プロジェクトフォルダ**
```
C:\Users\Endeavor\Documents\001-YOLUBE\yolube_web\cursor\docs\backups\GAS_BACKUP_20251006.txt
```

**オプションC: クラウドストレージ**
- Google Drive
- OneDrive
- Dropbox

### ステップ 2: ファイル名の形式

推奨形式：
```
GAS_BACKUP_YYYYMMDD_HHMM.txt

例:
GAS_BACKUP_20251006_1430.txt
（2025年10月6日 14:30にバックアップ）
```

### ステップ 3: バージョン管理（推奨）

複数のバックアップを保持：

```
backups/
├─ GAS_BACKUP_20251006_1430.txt  ← 最初のバックアップ
├─ GAS_BACKUP_20251006_1530.txt  ← 修正前のバックアップ
└─ GAS_BACKUP_20251006_1630.txt  ← 修正後のバックアップ
```

---

## バックアップ確認チェックリスト

バックアップが完了したら、以下を確認：

- [ ] すべての `.gs` ファイルがバックアップされている
- [ ] ファイル名に日付が含まれている
- [ ] ファイルサイズが 0KB より大きい
- [ ] テキストエディタでバックアップファイルを開いて、コードが正しく保存されていることを確認
- [ ] バックアップファイルを安全な場所（複数箇所）に保存

---

## トラブルシューティング

### 問題1: 「Apps Script」メニューが表示されない

**原因**: アカウントに権限がない

**解決方法**:
1. スプレッドシートの所有者または編集者権限があるか確認
2. 管理者に連絡して権限を付与してもらう
3. 別のGoogleアカウントでログインする

### 問題2: Apps Scriptが開かない・エラーが表示される

**原因**:
- ブラウザのキャッシュ問題
- 複数アカウントログイン
- ブラウザ拡張機能の干渉

**解決方法**:
1. シークレットモードで開いているか確認
2. ブラウザのキャッシュをクリア
3. 別のブラウザで試す
4. ブラウザ拡張機能を無効化

### 問題3: コードが表示されるが、一部が切れている

**原因**: 長いコードの場合、エディタの表示領域に収まらない

**解決方法**:
1. エディタ内でスクロールして全体を確認
2. `Ctrl + End` で最後の行に移動
3. `Ctrl + Home` で最初の行に移動
4. 全選択（`Ctrl + A`）してコピー

### 問題4: コピーしたコードが文字化けする

**原因**: 文字コードの問題

**解決方法**:
1. メモ帳で保存する際、「ファイル」→「名前を付けて保存」
2. エンコード: 「UTF-8」を選択
3. 保存

---

## 次のステップ

バックアップが完了したら：

1. ✅ バックアップファイルを複数箇所に保存
2. ✅ バックアップファイルが正しく保存されているか確認
3. ✅ 次は「既存コードの分析」に進む

---

## 既存コードの分析（バックアップ後）

バックアップが完了したら、以下を確認します：

### 確認項目

1. **doPost関数の構造**
   ```javascript
   function doPost(e) {
     // どのようにリクエストを処理しているか？
     // formType パラメータをどう使っているか？
   }
   ```

2. **doGet関数の存在**
   ```javascript
   function doGet(e) {
     // GET リクエストを処理しているか？
   }
   ```

3. **お問い合わせフォーム処理**
   - formType: 'home'
   - formType: 'ke'
   - formType: 'training'

   これらがどのように処理されているか？

4. **メール送信関数**
   - `GmailApp.sendEmail()` の使用方法
   - メールテンプレート

5. **スプレッドシート操作**
   - データの保存先シート名
   - 列の構造

---

**バックアップ完了後、このドキュメントを保持してください。**
